<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Register Face</title>
		<style>
			/* Minimal mobile-first styling for face registration */
			body {
				display: flex;
				flex-direction: column;
				align-items: center;
				justify-content: center;
				margin: 0;
				font-family: Arial, sans-serif;
				padding: 16px;
				background: #fff;
			}
			main {
				width: 100%;
				max-width: 480px;
			}
			h1 {
				text-align: center;
				margin-bottom: 16px;
			}
			video {
				width: 100%;
				aspect-ratio: 4/3;
				border-radius: 4px;
				margin-bottom: 16px;
				background: #000;
			}
			.form-group {
				display: flex;
				flex-direction: column;
				gap: 8px;
				margin-bottom: 16px;
			}
			input, button {
				width: 100%;
				padding: 12px;
				font-size: 1rem;
				border: 1px solid #ccc;
				border-radius: 4px;
			}
			button {
				background-color: #4CAF50;
				color: #fff;
				border: none;
				cursor: pointer;
			}
			button:disabled {
				background-color: #ccc;
				cursor: default;
			}
			#registrationMessage {
				text-align: center;
				font-size: 1rem;
				color: #f00;
				min-height: 1.2em;
			}
		</style>
		
		<!-- Load face-api core library first -->
		<script src="./js/face-api.min.js"></script>
		<!-- Then load the warm-up helper that depends on face-api -->
		<script src="./js/faceapi_warmup.js"></script>
		<script>
			function urlReplace(url) {
				window.location.replace(url); 
			}
		</script>
	</head>
	<body>
		<main>
			<h1>Register Face</h1>
			<video id="video" autoplay playsinline muted></video>
			<div class="form-group">
				<input id="userIdInput" type="text" placeholder="User ID">
				<input id="userNameInput" type="text" placeholder="Name">
				<button id="registerButton">Register</button>
			</div>
			<div id="registrationMessage"></div>
		</main>
		
		<script>
			function getParam(name){const p=new URLSearchParams(window.location.search);return p.get(name);} 
			document.addEventListener('DOMContentLoaded',()=>{
				document.getElementById('userIdInput').value=getParam('userid')||'test001';
				document.getElementById('userNameInput').value=getParam('username')||'test';
				document.getElementById('registerButton').addEventListener('click',video_face_detection);
			});
		</script>
		
		<script>
			/**
			 * ================================
			 * Face-API Configuration
			 * -------------------------------
			 * faceapi_action
			 *   • "verify"   – Compare the live video frame against a previously
			 *     registered reference descriptor (used in a face-verification flow).
			 *   • "register" – Capture the detected face descriptor and store it as
			 *     a new reference (used when enrolling a new user).
			 *
			 * face_detector_options_setup
			 *   These options are forwarded to face-api.js TinyFaceDetector and allow
			 *   you to balance performance vs. accuracy according to your use-case.
			 *   • inputSize        – Dimension (square) of the NN input. Larger numbers
			 *                         improve accuracy but require more computation.
			 *   • scoreThreshold   – Minimum confidence score (0-1) that a detection
			 *                         must reach to be considered valid. 0.8 = 80%.
			 *   • maxDetectedFaces – Hard limit on how many faces should be processed
			 *                         per frame. Keeping it at 1 speeds things up when
			 *                         you only care about the user in front of the
			 *                         camera.
			 * ================================
			 */
			var faceapi_action = "register"; // verify, register
			var warmup_completed = [camera_start, video_face_detection];
			var face_detector_options_setup = {
				inputSize: 128,
				scoreThreshold: 0.75, // 0.8 = 80%
				maxDetectedFaces: 1,
			};
		</script>
	</body>
</html>
